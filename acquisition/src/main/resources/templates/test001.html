<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OCR 文件上传测试</title>
  <!-- 引入 Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入 Inter 字体 -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6; /* 柔和的背景色 */
    }
    /* 自定义加载动画 */
    .loader {
      border: 4px solid #f3f3f3; /* Light grey */
      border-top: 4px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6">
<div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-md md:max-w-lg lg:max-w-xl">
  <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center">OCR 文件上传测试</h1>

  <div class="mb-6">
    <label for="imageUpload" class="block text-lg font-medium text-gray-700 mb-2">选择图片文件 (屏幕截图)</label>
    <input type="file" id="imageUpload" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-700">
    <p class="mt-1 text-sm text-gray-500">支持图片格式，如 PNG, JPG。</p>
  </div>

  <button id="uploadButton" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-300 ease-in-out flex items-center justify-center">
    <span id="buttonText">上传并识别</span>
    <div id="loadingSpinner" class="loader ml-2 hidden"></div>
  </button>

  <div id="resultContainer" class="mt-8 p-4 bg-gray-100 rounded-md border border-gray-200 hidden">
    <h2 class="text-xl font-semibold text-gray-800 mb-3">识别结果:</h2>
    <pre id="ocrResult" class="whitespace-pre-wrap break-words text-gray-900 text-sm leading-relaxed"></pre>
  </div>

  <div id="errorMessage" class="mt-4 p-3 bg-red-100 text-red-700 rounded-md border border-red-200 hidden">
    <p class="font-medium">错误:</p>
    <p id="errorText" class="text-sm"></p>
  </div>
</div>

<script>
  const imageUpload = document.getElementById('imageUpload');
  const uploadButton = document.getElementById('uploadButton');
  const buttonText = document.getElementById('buttonText');
  const loadingSpinner = document.getElementById('loadingSpinner');
  const resultContainer = document.getElementById('resultContainer');
  const ocrResult = document.getElementById('ocrResult');
  const errorMessage = document.getElementById('errorMessage');
  const errorText = document.getElementById('errorText');

  uploadButton.addEventListener('click', async () => {
    const file = imageUpload.files[0];

    // 检查是否选择了文件
    if (!file) {
      showError('请先选择一个图片文件。');
      return;
    }

    // 隐藏之前的结果和错误信息
    resultContainer.classList.add('hidden');
    errorMessage.classList.add('hidden');
    ocrResult.textContent = '';
    errorText.textContent = '';

    // 显示加载状态
    uploadButton.disabled = true;
    buttonText.textContent = '上传中...';
    loadingSpinner.classList.remove('hidden');

    try {
      const formData = new FormData();
      // 将文件添加到 FormData，字段名为 'image'
      // 注意：根据后端接口实际接收的文件字段名调整 'image'
      formData.append('file', file);

      // 构建请求URL
      // 假设后端接口是 /ocr/find/text，并且文件内容在请求体中
      // 用户提到的 ?file= 参数可能表示文件名，但通常文件上传是multipart/form-data
      // 如果后端确实需要文件名作为查询参数，您可能需要调整URL
      const uploadUrl = '/ocr/find/text'; // 默认假设接口路径
      // const uploadUrl = `/ocr/find/text?file=${encodeURIComponent(file.name)}`; // 如果后端需要文件名作为查询参数

      const response = await fetch(uploadUrl, {
        method: 'POST',
        body: formData // fetch 会自动设置 Content-Type: multipart/form-data
      });

      if (!response.ok) {
        // 如果响应状态码不是 2xx，则抛出错误
        const errorData = await response.json().catch(() => response.text());
        throw new Error(`HTTP 错误! 状态: ${response.status}, 消息: ${JSON.stringify(errorData)}`);
      }

      // 尝试解析JSON响应
      const result = await response.json();
      ocrResult.textContent = JSON.stringify(result, null, 2); // 美化JSON输出
      resultContainer.classList.remove('hidden');

    } catch (error) {
      console.error('上传失败:', error);
      showError(`文件上传或识别失败: ${error.message}`);
    } finally {
      // 恢复按钮状态
      uploadButton.disabled = false;
      buttonText.textContent = '上传并识别';
      loadingSpinner.classList.add('hidden');
    }
  });

  function showError(message) {
    errorText.textContent = message;
    errorMessage.classList.remove('hidden');
  }
</script>
</body>
</html>
